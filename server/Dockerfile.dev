FROM golang:1.25.6-alpine

WORKDIR /app

# Copy go.mod and go.sum first for better layer caching
COPY go.mod go.sum ./
RUN go mod download

# Copy the rest of the source code (done last to maximize cache efficiency)
COPY . .

EXPOSE 7331

CMD ["go", "tool", "templ", "generate", "--watch", \
     "--proxy=http://localhost:8080", \
     "--proxybind=0.0.0.0", \
     "--open-browser=false", \
     "--cmd", "go run ."]
